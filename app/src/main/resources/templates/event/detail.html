<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EAT-F by Chunderella</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link href="/css/style.css" rel="stylesheet">

    <!-- 서머노트css -->
    <!-- include libraries(jQuery, bootstrap) -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
          rel="stylesheet">

    <!-- include summernote css/js -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css"
          rel="stylesheet">
    <!-- 서머노트css end-->

<!--결제관련---->
    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
    <!-- iamport.payment.js -->
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>

    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
    <!-- iamport.payment.js -->
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
</head>

<body>
<!-------------------------------구분선-------------------------->
<div class="b-example-divider"></div>
<!------------------------------header------------------------------>
<header class="p-3 mb-3 bg-white border-bottom fixed-top">
    <div class="container">
        <div
                class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a class="navbar-brand" th:href="@{/}">
                <img src="/images/logo.png" alt="Bootstrap" width="100" height="88">
            </a>
            <!-------------------------------구분선-------------------------->
            <div class="col-2"></div>

            <form class="col-12 col-lg-4 mb-3 mb-lg-0 me-lg-4" role="search">
                <input type="search" class="form-control" placeholder="Search..." aria-label="Search">
            </form>

            <!-------------------------------구분선-------------------------->
            <div class="col-2"></div>

            <div th:if="${session.loginMember == null}" class="d-grid me-lg-4 gap-2">
                <button type="button" onclick="location.href='/auth/login'" class="btn btn-secondary"
                        data-bs-toggle="button">로그인
                </button>
            </div>

            <div th:if="${session.loginMember != null}" class="d-grid me-lg-4 gap-2">
                <button type="button" onclick="location.href='/auth/logout'" class="btn btn-secondary"
                        data-bs-toggle="button">로그아웃
                </button>
            </div>

            <div class="dropdown text-end me-lg-4">
                <a href="#" class="d-block link-dark text-decoration-none dropdown-toggle"
                   data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="/images/mypage.png" alt="mdo" width="32" height="32" class="rounded-circle">
                </a>

                <ul class="dropdown-menu text-small ">
                  <li th:if="${session.loginMember != null}"><a class="dropdown-item" href="#">New project...</a></li>
                  <li th:if="${session.loginMember != null}"><a class="dropdown-item" th:href="@{/my/main}">마이페이지</a></li>
                  <li th:if="${session.loginMember != null}"><a class="dropdown-item" href="#">설정</a></li>
                  <li th:if="${session.loginMember != null}"><a class="dropdown-item" href="#">프로필</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li th:if="${session.loginMember == null}"><a class="dropdown-item"
                                                                  th:href="@{/register/add}">회원가입</a></li>
                    <li th:if="${session.loginMember == null}"><a class="dropdown-item"
                                                                  th:href="@{/auth/login}">로그인</a></li>
                    <!--          </li>-->
                    <li th:if="${session.loginMember != null}"><a class="dropdown-item"
                                                                  th:href="@{/auth/logout}">로그아웃</a></li>
                </ul>
            </div>
        </div>
    </div>
</header>
<!-------------------------------구분선-------------------------->
<div class="line-3"></div>
<div class="line-3"></div>
<!------------------------------nav------------------------------>
<div th:replace="/common/nav.html :: fragment-nav"></div>
<!-------------------------------구분선-------------------------->
<div class="a-example-divider"></div>
<!---------------------------- 상세보기 ------------------------------>

<div class="container p-3  border rounded text-center">

    <div class="row p-3 border-bottom">
        <div class="col">
            <div class="eventNo">
                <p th:value="${event.no}"></p>
            </div>
        </div>
    </div>


    <div class="row p-3 border-bottom">
        <div class="col">

            <h2 th:text="${event.title}"></h2>

        </div>
    </div>

    <div class="row p-3">
        <div class="col">
            <p th:text="'작성자 : ' + ${event.writer.nick}"> </p>
        </div>

        <div class="col">
            <p th:text="'작성일 : ' + ${#dates.format(event.createDate, 'yyyy-MM-dd HH:mm:ss')}"></p>
        </div>

        <div class="col">
            <p th:text="'조회수 : ' + ${event.viewCnt}"></p>
        </div>

    </div>

    <div class="row p-3">
        <div class="col p-3">

            <textarea id="summernote" name='content'th:value="${event.content}"> </textarea>

        </div>
    </div>

</div> <!--컨테이너 끝!!!!!-->

<div class ="container rounded border">
    <div class="row p-3">
        <div class="col">
            <h4><b>파티정보</b></h4>
        </div>
    </div>

    <div class="row p-3">
        <div class="col">
            <p th:text="'장소명 : ' + ${event.location}"></p>
        </div>

        <div class="col">
            <p th:text="'상세주소 : ' + ${event.address}"></p>
        </div>

        <div class="col">
            <p th:text="'파티일 : ' + ${#dates.format(event.date, 'yyyy-MM-dd HH:mm:ss')}"></p>
        </div>
    </div>

</div>

<form>
<div class ="container rounded border">
    <input style="display: none" name="no" id="eno" type="number" th:value="${event.no}" readonly />
    <div class="row p-3">
        <div class="col">
            <h4><b>이벤트 입장권 구매하기</b></h4>
        </div>
    </div>

    <div class="row p-3">
        <div class="col">
           <span id="cost" th:text="${event.cost}"></span>
            </div>
        </div>

        <div class="col">
            <div class="paycnt">  <p>수량</p>
                <input id="paycnt" type="number"/>
            </div>
        </div>

        <div class="col">
            <div class="totalcost">  <p  id="totalcost" th:text="'총금액 : ' + ${event.cost} + '원'"> </p>

            </div>

    </div>


    <button onclick="requestPay()">결제하기</button>



</div>
</div>
</form>

<script>
    var totalcost = 0;

    $('#paycnt').on('change',function (e){
        var cost = $("#cost").text();
        var totalcost =(cost * e.target.value);
        $("#totalcost").text(totalcost);
        console.log(e.target.value);

        console.log("금액 :  " , totalcost);

    })
    function requestPay(){
        let totalcost = $("#totalcost").text();
        let eno = $("#eno").val();
        let paycnt = $("#paycnt").val();
        // let now = new Date();
        // console.log("현재 : ", now);
        // let paydate = $("#paydate").val();
        console.log(totalcost);
        console.log(eno);


        let ticket = {
            totalcost : totalcost,
            eno : eno,
            paycnt : paycnt,
        };

        $.ajax({
            url : "/event/ticketing",
            type : 'GET',
            data : ticket,
            dataType : 'json',
            contentType:'application/json; charset=UTF-8' ,
            success:function (result){
                if(result == "1"){
                    alert("결제성공");
                }else if (result == "0"){
                    alert("결제에 실패하셨습니다. 문의해주세요.");
                }
            },
            error(error){
                alert("통신 에러 문의해주세요.");
                console.log(error.status);
            }

        });

        console.log(cost);


    }



</script>


<script>
    /*아임포트 카카오페이 결제*/
    $('#paymentBtn').click(function () {
        var IMP = window.IMP;
        IMP.init('TC0ONETIME');

        //DOM객체들에서 사용할 데이터 뽑기
        var paymentGoods = $('input[name="paymentOrderName"]').val();
        var money = $('.totalprice').text();
        var memberName = $('input[name="memberName"]').val();
        var memberEmail = $('input[name="memberEmail"]').val();
        var memberPhone = $('input[name="memberPhone"]').val();

        var len = memberEmail.indexOf("@");
        var memberId = memberEmail.substr(0, len);


        IMP.request_pay({
            //카카오페이 결제시 사용할 정보 입력
            pg: 'card',
            paymentCode: 'p' + new Date().getTime()+'_'+memberId,
            name: paymentGoods,
            amount: money,
            buyer_email: memberEmail,
            buyer_name: memberName,
            buyer_tel: memberPhone,
        }, function (rsp) {
            //결제 완료시
            if (rsp.success) {
                var msg = '결제가 완료되었습니다.';
                msg += '카드 승인번호 : ' + rsp.apply_num;

                /*
                만약 데이터들을 ajax로 보낼 시 사용할 코드
                $.ajax({
                    type: "GET",
                    url: "/mypage/mypaymentList/paymentDetail",
                    data: {
                        "amount" : money
                    },
                });
                */

                $('#paymentForm').submit();

            } else {
                //결제 실패시
                var msg = '결제에 실패하였습니다.';
                msg += '에러내용 : ' + rsp.error_msg;

                if($('input[name="eClassApprovedSetDate"]').length){
                    document.location.href="/mypage/mySignUpForClassList"; //alert창 확인 후 이동할 url 설정
                }else {
                    document.location.href="/challenge/challengeGather/challengeGatherList"; //alert창 확인 후 이동할 url 설정
                }
            }
            alert(msg);
        });
    });
    </script>



<!--        <form th:action="@{/event/update}" method="post" enctype="multipart/form-data">-->
<!--        <div class="container text-center border rounded">-->
<!--            <input name="no" type="number" value="1" th:value="${event.no}" readonly hidden/>-->
<!--            <div class="line-3"></div>-->

<!--            <div class="row">-->
<!--                <div class="col-2">-->
<!--                </div>-->
<!--                <div class="col-8">-->

<!--                </div>-->
<!--                <div class="col"-2>-->
<!--            </div>-->
<!--            </div>-->
<!--            <div class="row">-->
<!--                <div class="col-1">-->
<!--                    <span>내용</span>-->
<!--                </div>-->
<!--                <div class="col-10 border rounded">-->
<!--                    <span th:value="${event.content}"></span>-->
<!--                </div>-->
<!--                <div class="col">-->
<!--                </div>-->
<!--            </div>-->

<!--</div>-->




<!--        <table border='1'>-->
<!--            <input name="no" type="number" value="1" th:value="${event.no}" readonly hidden/>-->
<!--            <tr>-->
<!--                <th>제목</th><td><input name='title' type='text'-->
<!--                                      value='제목'-->
<!--                                      th:value="${event.title}"-->
<!--                                      size='60'></td>-->
<!--            </tr>-->
<!--            <tr>-->
<!--            </tr>-->
<!--            <tr>-->
<!--                <th>조회수</th><td th:text="${event.viewCnt}"></td>-->
<!--            </tr>-->
<!--            <tr>-->
<!--                <th>작성자</th><td th:text="${event.writer.nick}"></td>-->
<!--            </tr>-->
<!--            <tr>-->
<!--                <th>등록일</th><td th:date="${event.createDate}"></td>-->
<!--            </tr>-->
<!--            &lt;!&ndash;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; 파일첨부 &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&ndash;&gt;-->
<!--            <tr>-->
<!--                <th>첨부파일</th>-->
<!--                <td>-->
<!--                    <ul>-->
<!--                        <li data-th-each="file : ${event.attachedFiles}">-->
<!--                            &lt;!&ndash; {path} = path=${file.filepath} &ndash;&gt;-->
<!--                            <a href=""-->
<!--                               data-th-href="@{files/{path}(path=${file.filepath})}"-->
<!--                               data-th-text="${file.filepath}">test.gif</a>-->
<!--                            [<a href="fileDelete?no=1"-->
<!--                                data-th-href="@{fileDelete(no=${file.no})}">파일삭제</a>]-->
<!--                        </li>-->
<!--                    </ul>-->
<!--                    파일 추가: <input name='files' type="file" multiple>-->
<!--                </td>-->
<!--            </tr>-->
<!--            &lt;!&ndash;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; 파일첨부 end&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&ndash;&gt;-->
<!--        </table>-->

<!--    </form>-->
<!--</div>-->




<!--<button onclick="requestPay()">결제하기</button>-->
<!--<button class="btn btn-default btn-cart">장바구니</button>-->
<!--<button class="btn btn-default btn-wishlist">위시리스트</button>-->
<!--&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
<!--<script>-->
<!--    function iamport(){-->
<!--        //가맹점 식별코드-->
<!--        IMP.init('imp30146952');-->
<!--        IMP.request_pay({-->
<!--            pg : 'kcp',-->
<!--            pay_method : 'card',-->
<!--            merchant_uid : 'merchant_' + new Date().getTime(),-->
<!--            name : '상품1' , //결제창에서 보여질 이름-->
<!--            amount : 100, //실제 결제되는 가격-->
<!--            buyer_email : 'iamport@siot.do',-->
<!--            buyer_name : '구매자이름',-->
<!--            buyer_tel : '010-1234-5678',-->
<!--            buyer_addr : '서울 강남구 도곡동',-->
<!--            buyer_postcode : '123-456'-->
<!--        }, function(rsp) {-->
<!--            console.log(rsp);-->
<!--            if ( rsp.success ) {-->
<!--                var msg = '결제가 완료되었습니다.';-->
<!--                msg += '고유ID : ' + rsp.imp_uid;-->
<!--                msg += '상점 거래ID : ' + rsp.merchant_uid;-->
<!--                msg += '결제 금액 : ' + rsp.paid_amount;-->
<!--                msg += '카드 승인번호 : ' + rsp.apply_num;-->
<!--            } else {-->
<!--                var msg = '결제에 실패하였습니다.';-->
<!--                msg += '에러내용 : ' + rsp.error_msg;-->
<!--            }-->
<!--            alert(msg);-->
<!--        });-->
<!--    }-->
<!--</script>-->


<!---------------------------- 상세보기 end ------------------------------>

<!-------------------------------구분선-------------------------->
<div class="c-example-divider"></div>
<!------------------------------footer------------------------------>
<footer class="py-3 my-4">
    <ul class="nav justify-content-center border-bottom pb-3 mb-3">
        <li class="nav-item"><a th:href="@{/}" class="nav-link px-2 text-muted">Home</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Features</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Pricing</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">FAQs</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
    </ul>
    <p class="text-center text-muted">© 2022 Chunderella Corp & TwoAppleteam. All Rights Reserved.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>

<!-- 서머노트 -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
<!-- 서머노트 end -->

<script>
    var IMP = window.IMP; // 생략가능
    IMP.init('imp75675775'); // <-- 본인 가맹점 식별코드 삽입


</script>
<script>

/*아임포트 카카오페이 결제*/
$('#paymentBtn').click(function () {
var IMP = window.IMP;
IMP.init('아임포트 본인 가맹점식별코드');

//DOM객체들에서 사용할 데이터 뽑기
var paymentGoods = $('input[name="paymentOrderName"]').val();
var money = $('.totalprice').text();
var memberName = $('input[name="memberName"]').val();
var memberEmail = $('input[name="memberEmail"]').val();
var memberPhone = $('input[name="memberPhone"]').val();

var len = memberEmail.indexOf("@");
var memberId = memberEmail.substr(0, len);


IMP.request_pay({
//카카오페이 결제시 사용할 정보 입력
pg: 'card',
paymentCode: 'p' + new Date().getTime()+'_'+memberId,
name: paymentGoods,
amount: money,
buyer_email: memberEmail,
buyer_name: memberName,
buyer_tel: memberPhone,
}, function (rsp) {
//결제 완료시
if (rsp.success) {
var msg = '결제가 완료되었습니다.';
msg += '카드 승인번호 : ' + rsp.apply_num;

/*
만약 데이터들을 ajax로 보낼 시 사용할 코드
$.ajax({
type: "GET",
url: "/mypage/mypaymentList/paymentDetail",
data: {
"amount" : money
},
});
*/

$('#paymentForm').submit();

} else {
//결제 실패시
var msg = '결제에 실패하였습니다.';
msg += '에러내용 : ' + rsp.error_msg;

if($('input[name="eClassApprovedSetDate"]').length){
document.location.href="/mypage/mySignUpForClassList"; //alert창 확인 후 이동할 url 설정
}else {
document.location.href="/challenge/challengeGather/challengeGatherList"; //alert창 확인 후 이동할 url 설정
}
}
alert(msg);
});
});
</script>


<script>
    $(".btn-order").click(function() {
        location.assign("/order/insert");
    });

    $(".btn-cart").click(function() {
        var check = confirm("상품이 장바구니에 담겼습니다. 확인하시겠습니까?");
        if (check) {
            location.assign("/order/cart");
        }
    });

    $(".btn-wishlist").click(function() {
        alert("상품을 위시리스트에 추가하였습니다.");
    });
</script>
<!-- 서머노트 -->
<script>
    $(document).ready(function() {
        $('textarea[name=content]').html('[[${event.content}]]')

        $('textarea[name=content]').summernote({
            toolbar:false,
            height: 300,
            width: 1140,
            minHeight : null,
            maxHeight : null,
            disableDragAndDrop: true
        });

        $('textarea[name=content]').summernote('disable');
    });
</script>
<!-- 서머노트 end-->

</body>
</html>



